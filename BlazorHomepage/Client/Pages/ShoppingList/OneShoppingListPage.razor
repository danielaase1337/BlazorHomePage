@page "/shoppinglist/{id}"
@if (ThisShoppingList != null)
{
    <h4>@ThisShoppingList.Name</h4>
    @if (ThisShoppingList.IsDone)
    {
        <p>Ferdig handlet</p>
    }

    <div class="todoapp">
        <ul class="todo-list">
            @foreach (var vare in ThisShoppingList.ShoppingItems)
            {
                <li>
                   <OneShoppingListItemComponent OneShoppingListItem="vare" DeleteVareCallback="@(f=> DeleteVare(vare))" />
                </li>
            }
        </ul>
    </div>
}
else
{
    <p>loading...</p>
}
@code{

    [Parameter]
    public string Id { get; set; }

    public ShoppingListModel ThisShoppingList { get; set; }
    [Inject]
    public IShoppingListDataManager ShoppingListDataManager { get; set; }

    protected override async Task OnParametersSetAsync()
    {
        var ok = int.TryParse(Id, out int idAsInt);
        if (!ok)
            return;
        await ShoppingListDataManager.GetOneShoppingListAsync(idAsInt).ContinueWith(f =>
        {
            if(f.Result != null)
                ThisShoppingList = f.Result;
        });
    }
    public async Task DeleteVare(ShoppingListItemModel m)
    {
        ThisShoppingList.ShoppingItems.Remove(m);

        var updated = await ShoppingListDataManager.Update<ShoppingListModel>(ThisShoppingList);
        ThisShoppingList = updated; 

    }

}